#!/bin/bash
#================================================
# Panda Script v2.0 - Malware Scanner (ClamAV)
#================================================

source "${PANDA_DIR:-/opt/panda}/core/init.sh" 2>/dev/null || true

install_clamav() {
    log_info "Installing ClamAV Scanner..."
    apt-get update
    apt-get install -y clamav clamav-daemon
    systemctl stop clamav-freshclam
    freshclam
    systemctl start clamav-freshclam
    log_success "ClamAV installed and virus database updated."
    pause
}

scan_web_directory() {
    local domain="$1"
    [[ -z "$domain" ]] && { log_error "Domain required"; return 1; }
    
    local path="/home/$domain/public"
    [[ ! -d "$path" ]] && { log_error "Directory $path not found."; return 1; }
    
    log_info "Scanning $path for malware..."
    clamscan -r -i "$path" | tee "/var/log/panda_scan_${domain}.log"
    
    log_success "Scan completed. Results saved to /var/log/panda_scan_${domain}.log"
    pause
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    install_clamav
fi
