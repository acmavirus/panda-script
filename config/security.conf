# Panda Script - Security Configuration
# Version: 2.0.0
# Website: https://panda-script.com

#================================================
# FIREWALL SETTINGS
#================================================
[firewall]
enabled = true
# Backend: firewalld, ufw, iptables, nftables
backend = auto

# Default policy
default_input = DROP
default_forward = DROP
default_output = ACCEPT

# Allowed ports (comma separated)
tcp_ports = 22,80,443
udp_ports = 

# SSH port (if changed from 22)
ssh_port = 22

# ICMP (ping)
allow_icmp = true

# Logging
log_dropped = true
log_level = low

#================================================
# RATE LIMITING
#================================================
[rate_limit]
enabled = true

# SSH rate limit
ssh_rate = 5/minute
ssh_burst = 10

# HTTP rate limit (requests per second per IP)
http_rate = 10
http_burst = 50

# Connection limit per IP
conn_limit_per_ip = 100
conn_limit_per_ip_http = 50

# New connections per second per IP
new_conn_rate = 50

#================================================
# GEO BLOCKING
#================================================
[geo_block]
enabled = false
# Mode: whitelist or blacklist
mode = blacklist
# Countries (ISO 2-letter codes, comma separated)
countries = CN,RU,KP
# GeoIP database path
geoip_db = /usr/share/GeoIP/GeoLite2-Country.mmdb
# Update interval (days)
update_interval = 7

#================================================
# IP BLACKLIST
#================================================
[blacklist]
enabled = true
# External blacklists (URLs, comma separated)
external_lists = 
# Update interval (hours)
update_interval = 24
# Permanent blacklist file
permanent_file = /opt/panda/data/blacklist.txt
# Whitelist file (never block these IPs)
whitelist_file = /opt/panda/data/whitelist.txt

#================================================
# FAIL2BAN
#================================================
[fail2ban]
enabled = true

# SSH jail
ssh_enabled = true
ssh_maxretry = 5
ssh_findtime = 600
ssh_bantime = 3600

# Nginx jails
nginx_http_auth_enabled = true
nginx_http_auth_maxretry = 5
nginx_http_auth_bantime = 3600

nginx_botsearch_enabled = true
nginx_botsearch_maxretry = 2
nginx_botsearch_bantime = 604800

nginx_badbots_enabled = true
nginx_badbots_maxretry = 2
nginx_badbots_bantime = 604800

nginx_noscript_enabled = true
nginx_noscript_maxretry = 5
nginx_noscript_bantime = 86400

#================================================
# SSH HARDENING
#================================================
[ssh]
# Disable root login
permit_root_login = prohibit-password

# Disable password auth (key only)
password_auth = yes

# Max auth tries
max_auth_tries = 5

# Max sessions
max_sessions = 3

# Client alive interval
client_alive_interval = 300
client_alive_count_max = 2

# 2FA (Google Authenticator)
two_factor_enabled = false

#================================================
# FILE INTEGRITY (AIDE)
#================================================
[aide]
enabled = true
# Check schedule (cron format)
schedule = 0 3 * * *
# Email report
email_report = true
# Paths to monitor
paths = /etc,/bin,/sbin,/usr/bin,/usr/sbin,/var/www
# Paths to exclude
exclude_paths = /var/www/*/cache,/var/www/*/logs

#================================================
# MALWARE SCANNING
#================================================
[malware]
enabled = true
# Scanner: clamav, maldet, rkhunter
scanner = clamav
# Scan schedule (cron format)
schedule = 0 4 * * *
# Paths to scan
scan_paths = /var/www,/home
# Quarantine infected files
quarantine = true
quarantine_path = /opt/panda/quarantine
# Email report
email_report = true

#================================================
# KERNEL HARDENING
#================================================
[kernel]
# Enable hardening
hardening_enabled = true

# Network hardening
tcp_syncookies = 1
rp_filter = 1
accept_source_route = 0
accept_redirects = 0
send_redirects = 0
log_martians = 1

# Memory hardening
randomize_va_space = 2
dmesg_restrict = 1
kptr_restrict = 2

#================================================
# SSL/TLS SETTINGS
#================================================
[ssl]
# Minimum TLS version
min_version = TLSv1.2
# Preferred ciphers
ciphers = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
# HSTS
hsts_enabled = true
hsts_max_age = 31536000
hsts_include_subdomains = true
# OCSP Stapling
ocsp_stapling = true
